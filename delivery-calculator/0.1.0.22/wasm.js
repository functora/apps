var h$wasm;(()=>{var __webpack_modules__={431:(module,__webpack_exports__2,__webpack_require__2)=>{"use strict";__webpack_require__2.a(module,async(__webpack_handle_async_dependencies__,__webpack_async_result__)=>{try{__webpack_require__2.d(__webpack_exports__2,{A:()=>__WEBPACK_DEFAULT_EXPORT__});class JSValManager{#lastk=0;#kv=new Map;constructor(){}#allocKey(){let k=this.#lastk;for(;;){if(!this.#kv.has(k))return this.#lastk=k,k;k=k+1|0}}newJSVal(v){const k=this.#allocKey();return this.#kv.set(k,v),k}getJSVal(k){if(!this.#kv.has(k))throw new WebAssembly.RuntimeError(`getJSVal(${k})`);return this.#kv.get(k)}freeJSVal(k){if(!this.#kv.delete(k))throw new WebAssembly.RuntimeError(`freeJSVal(${k})`)}}class SetImmediate{#fs=[];#mc=new MessageChannel;constructor(){this.#mc.port1.addEventListener("message",()=>{this.#fs.pop()()}),this.#mc.port1.start()}setImmediate(cb,...args){this.#fs.push(()=>cb(...args)),this.#mc.port2.postMessage(void 0)}}let setImmediate;if(globalThis.setImmediate)setImmediate=globalThis.setImmediate;else try{setImmediate=(await Promise.resolve().then(function(){var e=new Error("Cannot find module 'node:timers'");throw e.code="MODULE_NOT_FOUND",e})).setImmediate}catch{const sm=new SetImmediate;setImmediate=(cb,...args)=>sm.setImmediate(cb,...args)}const __WEBPACK_DEFAULT_EXPORT__=__exports=>{const __ghc_wasm_jsffi_jsval_manager=new JSValManager,__ghc_wasm_jsffi_finalization_registry=new FinalizationRegistry(sp=>__exports.rts_freeStablePtr(sp));return{newJSVal:v=>__ghc_wasm_jsffi_jsval_manager.newJSVal(v),getJSVal:k=>__ghc_wasm_jsffi_jsval_manager.getJSVal(k),freeJSVal:k=>__ghc_wasm_jsffi_jsval_manager.freeJSVal(k),scheduleWork:()=>setImmediate(__exports.rts_schedulerLoop),ZC0ZCjsaddlezmwasmzm0zi0zi0zi0zmfb3b9895b4a2024a1a1630702ccc9280e3e5fb318e69f5e98dc1745edd2ea474ZCLanguageziJavascriptziJSaddleziWasmZC:($1,$2)=>new TextDecoder("utf-8",{fatal:!0}).decode(new Uint8Array(__exports.memory.buffer,$1,$2)),ZC1ZCjsaddlezmwasmzm0zi0zi0zi0zmfb3b9895b4a2024a1a1630702ccc9280e3e5fb318e69f5e98dc1745edd2ea474ZCLanguageziJavascriptziJSaddleziWasmZC:($1,$2,$3)=>new TextEncoder().encodeInto($1,new Uint8Array(__exports.memory.buffer,$2,$3)).written,ZC2ZCjsaddlezmwasmzm0zi0zi0zi0zmfb3b9895b4a2024a1a1630702ccc9280e3e5fb318e69f5e98dc1745edd2ea474ZCLanguageziJavascriptziJSaddleziWasmZC:$1=>$1.length,ZC3ZCjsaddlezmwasmzm0zi0zi0zi0zmfb3b9895b4a2024a1a1630702ccc9280e3e5fb318e69f5e98dc1745edd2ea474ZCLanguageziJavascriptziJSaddleziWasmZC:async($1,$2,$3)=>new Function("processResult","readBatch",`(()=>{${$1}})()`)($2,$3),ZC5ZCjsaddlezmwasmzm0zi0zi0zi0zmfb3b9895b4a2024a1a1630702ccc9280e3e5fb318e69f5e98dc1745edd2ea474ZCLanguageziJavascriptziJSaddleziWasmZC:$1=>()=>__exports.ghczuwasmzujsffiZC4ZCjsaddlezmwasmzm0zi0zi0zi0zmfb3b9895b4a2024a1a1630702ccc9280e3e5fb318e69f5e98dc1745edd2ea474ZCLanguageziJavascriptziJSaddleziWasmZC($1),ZC7ZCjsaddlezmwasmzm0zi0zi0zi0zmfb3b9895b4a2024a1a1630702ccc9280e3e5fb318e69f5e98dc1745edd2ea474ZCLanguageziJavascriptziJSaddleziWasmZC:$1=>a1=>__exports.ghczuwasmzujsffiZC6ZCjsaddlezmwasmzm0zi0zi0zi0zmfb3b9895b4a2024a1a1630702ccc9280e3e5fb318e69f5e98dc1745edd2ea474ZCLanguageziJavascriptziJSaddleziWasmZC($1,a1),ZC0ZCghczminternalZCGHCziInternalziWasmziPrimziExportsZC:($1,$2)=>$1.reject(new WebAssembly.RuntimeError($2)),ZC18ZCghczminternalZCGHCziInternalziWasmziPrimziExportsZC:($1,$2)=>$1.resolve($2),ZC19ZCghczminternalZCGHCziInternalziWasmziPrimziExportsZC:$1=>$1.resolve(),ZC20ZCghczminternalZCGHCziInternalziWasmziPrimziExportsZC:()=>{let res,rej;const p=new Promise((resolve,reject)=>{res=resolve,rej=reject});return p.resolve=res,p.reject=rej,p},ZC21ZCghczminternalZCGHCziInternalziWasmziPrimziExportsZC:($1,$2)=>__ghc_wasm_jsffi_finalization_registry.register($1,$2,$1),ZC18ZCghczminternalZCGHCziInternalziWasmziPrimziImportsZC:($1,$2)=>$1.then(()=>__exports.rts_promiseResolveUnit($2),err=>__exports.rts_promiseReject($2,err)),ZC0ZCghczminternalZCGHCziInternalziWasmziPrimziTypesZC:$1=>`${$1.stack?$1.stack:$1}`,ZC1ZCghczminternalZCGHCziInternalziWasmziPrimziTypesZC:($1,$2)=>new TextDecoder("utf-8",{fatal:!0}).decode(new Uint8Array(__exports.memory.buffer,$1,$2)),ZC2ZCghczminternalZCGHCziInternalziWasmziPrimziTypesZC:($1,$2,$3)=>new TextEncoder().encodeInto($1,new Uint8Array(__exports.memory.buffer,$2,$3)).written,ZC3ZCghczminternalZCGHCziInternalziWasmziPrimziTypesZC:$1=>$1.length,ZC4ZCghczminternalZCGHCziInternalziWasmziPrimziTypesZC:$1=>{if(!__ghc_wasm_jsffi_finalization_registry.unregister($1))throw new WebAssembly.RuntimeError("js_callback_unregister")},ZC0ZCghczminternalZCGHCziInternalziWasmziPrimziConcziInternalZC:async $1=>new Promise(res=>setTimeout(res,$1/1e3))}};__webpack_async_result__()}catch(e){__webpack_async_result__(e)}},1)},151:()=>{(function(){function patch(x){document.getElementsByTagName("head")[0].appendChild(x)}document.title="Delivery Calculator";var x0=document.createElement("meta");x0.name="viewport",x0.content="width=device-width, initial-scale=1",patch(x0);var x1=document.createElement("link");x1.rel="apple-touch-icon",x1.sizes="180x180",x1.href="static/apple-touch-icon.png",patch(x1);var x2=document.createElement("link");x2.rel="icon",x2.type="image/png",x2.sizes="32x32",x2.href="static/favicon-32x32.png",patch(x2);var x3=document.createElement("link");x3.rel="icon",x3.type="image/png",x3.sizes="16x16",x3.href="static/favicon-16x16.png",patch(x3);var x4=document.createElement("link");x4.rel="manifest",x4.href="site.webmanifest",patch(x4)})()},682:(module,__webpack_exports__2,__webpack_require__2)=>{"use strict";__webpack_require__2.a(module,async(__webpack_handle_async_dependencies__,__webpack_async_result__)=>{try{__webpack_require__2.r(__webpack_exports__2);var _app_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(151),_app_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__2.n(_app_js__WEBPACK_IMPORTED_MODULE_0__),_bjorn3_browser_wasi_shim__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(474),_dist_wasm_ghc_wasm_jsffi_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(431),__webpack_async_dependencies__=__webpack_handle_async_dependencies__([_dist_wasm_ghc_wasm_jsffi_js__WEBPACK_IMPORTED_MODULE_2__]);_dist_wasm_ghc_wasm_jsffi_js__WEBPACK_IMPORTED_MODULE_2__=(__webpack_async_dependencies__.then?(await __webpack_async_dependencies__)():__webpack_async_dependencies__)[0];async function main(){const args=[],env=[],fds=[new _bjorn3_browser_wasi_shim__WEBPACK_IMPORTED_MODULE_1__.TG(new _bjorn3_browser_wasi_shim__WEBPACK_IMPORTED_MODULE_1__.ZH([])),_bjorn3_browser_wasi_shim__WEBPACK_IMPORTED_MODULE_1__.Pn.lineBuffered(msg=>console.log(`[WASI stdout] ${msg}`)),_bjorn3_browser_wasi_shim__WEBPACK_IMPORTED_MODULE_1__.Pn.lineBuffered(msg=>console.warn(`[WASI stderr] ${msg}`))],options={debug:!1},wasi2=new _bjorn3_browser_wasi_shim__WEBPACK_IMPORTED_MODULE_1__.bJ(args,env,fds,options),instance_exports={},{instance}=await WebAssembly.instantiateStreaming(fetch("bin.wasm"),{wasi_snapshot_preview1:wasi2.wasiImport,ghc_wasm_jsffi:(0,_dist_wasm_ghc_wasm_jsffi_js__WEBPACK_IMPORTED_MODULE_2__.A)(instance_exports)});Object.assign(instance_exports,instance.exports),wasi2.initialize(instance),await instance.exports.hs_start()}main(),__webpack_async_result__()}catch(e){__webpack_async_result__(e)}})},474:(__unused_webpack___webpack_module__,__webpack_exports__2,__webpack_require__2)=>{"use strict";__webpack_require__2.d(__webpack_exports__2,{Pn:()=>ConsoleStdout,ZH:()=>File,TG:()=>OpenFile,bJ:()=>WASI});const FD_STDIN=0,FD_STDOUT=1,FD_STDERR=2,CLOCKID_REALTIME=0,CLOCKID_MONOTONIC=1,CLOCKID_PROCESS_CPUTIME_ID=2,CLOCKID_THREAD_CPUTIME_ID=3,ERRNO_SUCCESS=0,ERRNO_2BIG=1,ERRNO_ACCES=2,ERRNO_ADDRINUSE=3,ERRNO_ADDRNOTAVAIL=4,ERRNO_AFNOSUPPORT=5,ERRNO_AGAIN=6,ERRNO_ALREADY=7,ERRNO_BADF=8,ERRNO_BADMSG=9,ERRNO_BUSY=10,ERRNO_CANCELED=11,ERRNO_CHILD=12,ERRNO_CONNABORTED=13,ERRNO_CONNREFUSED=14,ERRNO_CONNRESET=15,ERRNO_DEADLK=16,ERRNO_DESTADDRREQ=17,ERRNO_DOM=18,ERRNO_DQUOT=19,ERRNO_EXIST=20,ERRNO_FAULT=21,ERRNO_FBIG=22,ERRNO_HOSTUNREACH=23,ERRNO_IDRM=24,ERRNO_ILSEQ=25,ERRNO_INPROGRESS=26,ERRNO_INTR=27,ERRNO_INVAL=28,ERRNO_IO=29,ERRNO_ISCONN=30,ERRNO_ISDIR=31,ERRNO_LOOP=32,ERRNO_MFILE=33,ERRNO_MLINK=34,ERRNO_MSGSIZE=35,ERRNO_MULTIHOP=36,ERRNO_NAMETOOLONG=37,ERRNO_NETDOWN=38,ERRNO_NETRESET=39,ERRNO_NETUNREACH=40,ERRNO_NFILE=41,ERRNO_NOBUFS=42,ERRNO_NODEV=43,ERRNO_NOENT=44,ERRNO_NOEXEC=45,ERRNO_NOLCK=46,ERRNO_NOLINK=47,ERRNO_NOMEM=48,ERRNO_NOMSG=49,ERRNO_NOPROTOOPT=50,ERRNO_NOSPC=51,ERRNO_NOSYS=52,ERRNO_NOTCONN=53,ERRNO_NOTDIR=54,ERRNO_NOTEMPTY=55,ERRNO_NOTRECOVERABLE=56,ERRNO_NOTSOCK=57,ERRNO_NOTSUP=58,ERRNO_NOTTY=59,ERRNO_NXIO=60,ERRNO_OVERFLOW=61,ERRNO_OWNERDEAD=62,ERRNO_PERM=63,ERRNO_PIPE=64,ERRNO_PROTO=65,ERRNO_PROTONOSUPPORT=66,ERRNO_PROTOTYPE=67,ERRNO_RANGE=68,ERRNO_ROFS=69,ERRNO_SPIPE=70,ERRNO_SRCH=71,ERRNO_STALE=72,ERRNO_TIMEDOUT=73,ERRNO_TXTBSY=74,ERRNO_XDEV=75,ERRNO_NOTCAPABLE=76,RIGHTS_FD_DATASYNC=null,RIGHTS_FD_READ=null,RIGHTS_FD_SEEK=null,RIGHTS_FD_FDSTAT_SET_FLAGS=null,RIGHTS_FD_SYNC=null,RIGHTS_FD_TELL=null,RIGHTS_FD_WRITE=64,RIGHTS_FD_ADVISE=null,RIGHTS_FD_ALLOCATE=null,RIGHTS_PATH_CREATE_DIRECTORY=null,RIGHTS_PATH_CREATE_FILE=null,RIGHTS_PATH_LINK_SOURCE=null,RIGHTS_PATH_LINK_TARGET=null,RIGHTS_PATH_OPEN=null,RIGHTS_FD_READDIR=null,RIGHTS_PATH_READLINK=null,RIGHTS_PATH_RENAME_SOURCE=null,RIGHTS_PATH_RENAME_TARGET=null,RIGHTS_PATH_FILESTAT_GET=null,RIGHTS_PATH_FILESTAT_SET_SIZE=null,RIGHTS_PATH_FILESTAT_SET_TIMES=null,RIGHTS_FD_FILESTAT_GET=null,RIGHTS_FD_FILESTAT_SET_SIZE=null,RIGHTS_FD_FILESTAT_SET_TIMES=null,RIGHTS_PATH_SYMLINK=null,RIGHTS_PATH_REMOVE_DIRECTORY=null,RIGHTS_PATH_UNLINK_FILE=null,RIGHTS_POLL_FD_READWRITE=null,RIGHTS_SOCK_SHUTDOWN=null;class Iovec{static read_bytes(view,ptr){const iovec=new Iovec;return iovec.buf=view.getUint32(ptr,!0),iovec.buf_len=view.getUint32(ptr+4,!0),iovec}static read_bytes_array(view,ptr,len){const iovecs=[];for(let i=0;i<len;i++)iovecs.push(Iovec.read_bytes(view,ptr+8*i));return iovecs}}class Ciovec{static read_bytes(view,ptr){const iovec=new Ciovec;return iovec.buf=view.getUint32(ptr,!0),iovec.buf_len=view.getUint32(ptr+4,!0),iovec}static read_bytes_array(view,ptr,len){const iovecs=[];for(let i=0;i<len;i++)iovecs.push(Ciovec.read_bytes(view,ptr+8*i));return iovecs}}const WHENCE_SET=0,WHENCE_CUR=1,WHENCE_END=2,FILETYPE_UNKNOWN=0,FILETYPE_BLOCK_DEVICE=1,FILETYPE_CHARACTER_DEVICE=2,FILETYPE_DIRECTORY=3,FILETYPE_REGULAR_FILE=4,FILETYPE_SOCKET_DGRAM=5,FILETYPE_SOCKET_STREAM=6,FILETYPE_SYMBOLIC_LINK=7;class Dirent{head_length(){return 24}name_length(){return this.dir_name.byteLength}write_head_bytes(view,ptr){view.setBigUint64(ptr,this.d_next,!0),view.setBigUint64(ptr+8,this.d_ino,!0),view.setUint32(ptr+16,this.dir_name.length,!0),view.setUint8(ptr+20,this.d_type)}write_name_bytes(view8,ptr,buf_len){view8.set(this.dir_name.slice(0,Math.min(this.dir_name.byteLength,buf_len)),ptr)}constructor(next_cookie,name,type){this.d_ino=1n;const encoded_name=new TextEncoder().encode(name);this.d_next=next_cookie,this.d_namlen=encoded_name.byteLength,this.d_type=type,this.dir_name=encoded_name}}const ADVICE_NORMAL=0,ADVICE_SEQUENTIAL=1,ADVICE_RANDOM=2,ADVICE_WILLNEED=3,ADVICE_DONTNEED=4,ADVICE_NOREUSE=5,FDFLAGS_APPEND=1,FDFLAGS_DSYNC=null,FDFLAGS_NONBLOCK=null,FDFLAGS_RSYNC=null,FDFLAGS_SYNC=null;class Fdstat{write_bytes(view,ptr){view.setUint8(ptr,this.fs_filetype),view.setUint16(ptr+2,this.fs_flags,!0),view.setBigUint64(ptr+8,this.fs_rights_base,!0),view.setBigUint64(ptr+16,this.fs_rights_inherited,!0)}constructor(filetype,flags){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=filetype,this.fs_flags=flags}}const FSTFLAGS_ATIM=null,FSTFLAGS_ATIM_NOW=null,FSTFLAGS_MTIM=null,FSTFLAGS_MTIM_NOW=null,OFLAGS_CREAT=1,OFLAGS_DIRECTORY=2,OFLAGS_EXCL=4,OFLAGS_TRUNC=8;class Filestat{write_bytes(view,ptr){view.setBigUint64(ptr,this.dev,!0),view.setBigUint64(ptr+8,this.ino,!0),view.setUint8(ptr+16,this.filetype),view.setBigUint64(ptr+24,this.nlink,!0),view.setBigUint64(ptr+32,this.size,!0),view.setBigUint64(ptr+38,this.atim,!0),view.setBigUint64(ptr+46,this.mtim,!0),view.setBigUint64(ptr+52,this.ctim,!0)}constructor(filetype,size){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=filetype,this.size=size}}const EVENTTYPE_CLOCK=0,EVENTTYPE_FD_READ=1,EVENTTYPE_FD_WRITE=2,EVENTRWFLAGS_FD_READWRITE_HANGUP=null,SUBCLOCKFLAGS_SUBSCRIPTION_CLOCK_ABSTIME=null,SIGNAL_NONE=0,SIGNAL_HUP=1,SIGNAL_INT=2,SIGNAL_QUIT=3,SIGNAL_ILL=4,SIGNAL_TRAP=5,SIGNAL_ABRT=6,SIGNAL_BUS=7,SIGNAL_FPE=8,SIGNAL_KILL=9,SIGNAL_USR1=10,SIGNAL_SEGV=11,SIGNAL_USR2=12,SIGNAL_PIPE=13,SIGNAL_ALRM=14,SIGNAL_TERM=15,SIGNAL_CHLD=16,SIGNAL_CONT=17,SIGNAL_STOP=18,SIGNAL_TSTP=19,SIGNAL_TTIN=20,SIGNAL_TTOU=21,SIGNAL_URG=22,SIGNAL_XCPU=23,SIGNAL_XFSZ=24,SIGNAL_VTALRM=25,SIGNAL_PROF=26,SIGNAL_WINCH=27,SIGNAL_POLL=28,SIGNAL_PWR=29,SIGNAL_SYS=30,RIFLAGS_RECV_PEEK=null,RIFLAGS_RECV_WAITALL=null,ROFLAGS_RECV_DATA_TRUNCATED=null,SDFLAGS_RD=null,SDFLAGS_WR=null,PREOPENTYPE_DIR=0;class PrestatDir{write_bytes(view,ptr){view.setUint32(ptr,this.pr_name_len,!0)}constructor(name_len){this.pr_name_len=name_len}}class Prestat{static dir(name_len){const prestat=new Prestat;return prestat.tag=PREOPENTYPE_DIR,prestat.inner=new PrestatDir(name_len),prestat}write_bytes(view,ptr){view.setUint32(ptr,this.tag,!0),this.inner.write_bytes(view,ptr+4)}}let Debug=class{enable(enabled){this.log=createLogger(enabled===void 0?!0:enabled,this.prefix)}get enabled(){return this.isEnabled}constructor(isEnabled){this.isEnabled=isEnabled,this.prefix="wasi:",this.enable(isEnabled)}};function createLogger(enabled,prefix){return enabled?console.log.bind(console,"%c%s","color: #265BA0",prefix):()=>{}}const debug=new Debug(!1);class WASIProcExit extends Error{constructor(code){super("exit with exit code "+code),this.code=code}}let WASI=class{start(instance){this.inst=instance;try{return instance.exports._start(),0}catch(e){if(e instanceof WASIProcExit)return e.code;throw e}}initialize(instance){this.inst=instance,instance.exports._initialize&&instance.exports._initialize()}constructor(args,env,fds,options={}){this.args=[],this.env=[],this.fds=[],debug.enable(options.debug),this.args=args,this.env=env,this.fds=fds;const self=this;this.wasiImport={args_sizes_get(argc,argv_buf_size){const buffer=new DataView(self.inst.exports.memory.buffer);buffer.setUint32(argc,self.args.length,!0);let buf_size=0;for(const arg of self.args)buf_size+=arg.length+1;return buffer.setUint32(argv_buf_size,buf_size,!0),debug.log(buffer.getUint32(argc,!0),buffer.getUint32(argv_buf_size,!0)),0},args_get(argv,argv_buf){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer),orig_argv_buf=argv_buf;for(let i=0;i<self.args.length;i++){buffer.setUint32(argv,argv_buf,!0),argv+=4;const arg=new TextEncoder().encode(self.args[i]);buffer8.set(arg,argv_buf),buffer.setUint8(argv_buf+arg.length,0),argv_buf+=arg.length+1}return debug.enabled&&debug.log(new TextDecoder("utf-8").decode(buffer8.slice(orig_argv_buf,argv_buf))),0},environ_sizes_get(environ_count,environ_size){const buffer=new DataView(self.inst.exports.memory.buffer);buffer.setUint32(environ_count,self.env.length,!0);let buf_size=0;for(const environ of self.env)buf_size+=environ.length+1;return buffer.setUint32(environ_size,buf_size,!0),debug.log(buffer.getUint32(environ_count,!0),buffer.getUint32(environ_size,!0)),0},environ_get(environ,environ_buf){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer),orig_environ_buf=environ_buf;for(let i=0;i<self.env.length;i++){buffer.setUint32(environ,environ_buf,!0),environ+=4;const e=new TextEncoder().encode(self.env[i]);buffer8.set(e,environ_buf),buffer.setUint8(environ_buf+e.length,0),environ_buf+=e.length+1}return debug.enabled&&debug.log(new TextDecoder("utf-8").decode(buffer8.slice(orig_environ_buf,environ_buf))),0},clock_res_get(id,res_ptr){let resolutionValue;switch(id){case CLOCKID_MONOTONIC:{resolutionValue=5000n;break}case CLOCKID_REALTIME:{resolutionValue=1000000n;break}default:return ERRNO_NOSYS}return new DataView(self.inst.exports.memory.buffer).setBigUint64(res_ptr,resolutionValue,!0),ERRNO_SUCCESS},clock_time_get(id,precision,time){const buffer=new DataView(self.inst.exports.memory.buffer);if(id===CLOCKID_REALTIME)buffer.setBigUint64(time,BigInt(new Date().getTime())*1000000n,!0);else if(id==CLOCKID_MONOTONIC){let monotonic_time;try{monotonic_time=BigInt(Math.round(performance.now()*1e6))}catch{monotonic_time=0n}buffer.setBigUint64(time,monotonic_time,!0)}else buffer.setBigUint64(time,0n,!0);return 0},fd_advise(fd,offset,len,advice){return self.fds[fd]!=null?self.fds[fd].fd_advise(offset,len,advice):ERRNO_BADF},fd_allocate(fd,offset,len){return self.fds[fd]!=null?self.fds[fd].fd_allocate(offset,len):ERRNO_BADF},fd_close(fd){if(self.fds[fd]!=null){const ret=self.fds[fd].fd_close();return self.fds[fd]=void 0,ret}else return ERRNO_BADF},fd_datasync(fd){return self.fds[fd]!=null?self.fds[fd].fd_datasync():ERRNO_BADF},fd_fdstat_get(fd,fdstat_ptr){if(self.fds[fd]!=null){const{ret,fdstat}=self.fds[fd].fd_fdstat_get();return fdstat?.write_bytes(new DataView(self.inst.exports.memory.buffer),fdstat_ptr),ret}else return ERRNO_BADF},fd_fdstat_set_flags(fd,flags){return self.fds[fd]!=null?self.fds[fd].fd_fdstat_set_flags(flags):ERRNO_BADF},fd_fdstat_set_rights(fd,fs_rights_base,fs_rights_inheriting){return self.fds[fd]!=null?self.fds[fd].fd_fdstat_set_rights(fs_rights_base,fs_rights_inheriting):ERRNO_BADF},fd_filestat_get(fd,filestat_ptr){if(self.fds[fd]!=null){const{ret,filestat}=self.fds[fd].fd_filestat_get();return filestat?.write_bytes(new DataView(self.inst.exports.memory.buffer),filestat_ptr),ret}else return ERRNO_BADF},fd_filestat_set_size(fd,size){return self.fds[fd]!=null?self.fds[fd].fd_filestat_set_size(size):ERRNO_BADF},fd_filestat_set_times(fd,atim,mtim,fst_flags){return self.fds[fd]!=null?self.fds[fd].fd_filestat_set_times(atim,mtim,fst_flags):ERRNO_BADF},fd_pread(fd,iovs_ptr,iovs_len,offset,nread_ptr){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const iovecs=Iovec.read_bytes_array(buffer,iovs_ptr,iovs_len),{ret,nread}=self.fds[fd].fd_pread(buffer8,iovecs,offset);return buffer.setUint32(nread_ptr,nread,!0),ret}else return ERRNO_BADF},fd_prestat_get(fd,buf_ptr){const buffer=new DataView(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const{ret,prestat}=self.fds[fd].fd_prestat_get();return prestat?.write_bytes(buffer,buf_ptr),ret}else return ERRNO_BADF},fd_prestat_dir_name(fd,path_ptr,path_len){if(self.fds[fd]!=null){const{ret,prestat_dir_name}=self.fds[fd].fd_prestat_dir_name();return prestat_dir_name!=null&&new Uint8Array(self.inst.exports.memory.buffer).set(prestat_dir_name,path_ptr),ret}else return ERRNO_BADF},fd_pwrite(fd,iovs_ptr,iovs_len,offset,nwritten_ptr){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const iovecs=Ciovec.read_bytes_array(buffer,iovs_ptr,iovs_len),{ret,nwritten}=self.fds[fd].fd_pwrite(buffer8,iovecs,offset);return buffer.setUint32(nwritten_ptr,nwritten,!0),ret}else return ERRNO_BADF},fd_read(fd,iovs_ptr,iovs_len,nread_ptr){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const iovecs=Iovec.read_bytes_array(buffer,iovs_ptr,iovs_len),{ret,nread}=self.fds[fd].fd_read(buffer8,iovecs);return buffer.setUint32(nread_ptr,nread,!0),ret}else return ERRNO_BADF},fd_readdir(fd,buf,buf_len,cookie,bufused_ptr){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){let bufused=0;for(;;){const{ret,dirent}=self.fds[fd].fd_readdir_single(cookie);if(ret!=0)return buffer.setUint32(bufused_ptr,bufused,!0),ret;if(dirent==null)break;if(buf_len-bufused<dirent.head_length()){bufused=buf_len;break}const head_bytes=new ArrayBuffer(dirent.head_length());if(dirent.write_head_bytes(new DataView(head_bytes),0),buffer8.set(new Uint8Array(head_bytes).slice(0,Math.min(head_bytes.byteLength,buf_len-bufused)),buf),buf+=dirent.head_length(),bufused+=dirent.head_length(),buf_len-bufused<dirent.name_length()){bufused=buf_len;break}dirent.write_name_bytes(buffer8,buf,buf_len-bufused),buf+=dirent.name_length(),bufused+=dirent.name_length(),cookie=dirent.d_next}return buffer.setUint32(bufused_ptr,bufused,!0),0}else return ERRNO_BADF},fd_renumber(fd,to){if(self.fds[fd]!=null&&self.fds[to]!=null){const ret=self.fds[to].fd_close();return ret!=0?ret:(self.fds[to]=self.fds[fd],self.fds[fd]=void 0,0)}else return ERRNO_BADF},fd_seek(fd,offset,whence,offset_out_ptr){const buffer=new DataView(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const{ret,offset:offset_out}=self.fds[fd].fd_seek(offset,whence);return buffer.setBigInt64(offset_out_ptr,offset_out,!0),ret}else return ERRNO_BADF},fd_sync(fd){return self.fds[fd]!=null?self.fds[fd].fd_sync():ERRNO_BADF},fd_tell(fd,offset_ptr){const buffer=new DataView(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const{ret,offset}=self.fds[fd].fd_tell();return buffer.setBigUint64(offset_ptr,offset,!0),ret}else return ERRNO_BADF},fd_write(fd,iovs_ptr,iovs_len,nwritten_ptr){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const iovecs=Ciovec.read_bytes_array(buffer,iovs_ptr,iovs_len),{ret,nwritten}=self.fds[fd].fd_write(buffer8,iovecs);return buffer.setUint32(nwritten_ptr,nwritten,!0),ret}else return ERRNO_BADF},path_create_directory(fd,path_ptr,path_len){const buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const path=new TextDecoder("utf-8").decode(buffer8.slice(path_ptr,path_ptr+path_len));return self.fds[fd].path_create_directory(path)}},path_filestat_get(fd,flags,path_ptr,path_len,filestat_ptr){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const path=new TextDecoder("utf-8").decode(buffer8.slice(path_ptr,path_ptr+path_len)),{ret,filestat}=self.fds[fd].path_filestat_get(flags,path);return filestat?.write_bytes(buffer,filestat_ptr),ret}else return ERRNO_BADF},path_filestat_set_times(fd,flags,path_ptr,path_len,atim,mtim,fst_flags){const buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const path=new TextDecoder("utf-8").decode(buffer8.slice(path_ptr,path_ptr+path_len));return self.fds[fd].path_filestat_set_times(flags,path,atim,mtim,fst_flags)}else return ERRNO_BADF},path_link(old_fd,old_flags,old_path_ptr,old_path_len,new_fd,new_path_ptr,new_path_len){const buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[old_fd]!=null&&self.fds[new_fd]!=null){const old_path=new TextDecoder("utf-8").decode(buffer8.slice(old_path_ptr,old_path_ptr+old_path_len)),new_path=new TextDecoder("utf-8").decode(buffer8.slice(new_path_ptr,new_path_ptr+new_path_len));return self.fds[new_fd].path_link(old_fd,old_flags,old_path,new_path)}else return ERRNO_BADF},path_open(fd,dirflags,path_ptr,path_len,oflags,fs_rights_base,fs_rights_inheriting,fd_flags,opened_fd_ptr){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const path=new TextDecoder("utf-8").decode(buffer8.slice(path_ptr,path_ptr+path_len));debug.log(path);const{ret,fd_obj}=self.fds[fd].path_open(dirflags,path,oflags,fs_rights_base,fs_rights_inheriting,fd_flags);if(ret!=0)return ret;self.fds.push(fd_obj);const opened_fd=self.fds.length-1;return buffer.setUint32(opened_fd_ptr,opened_fd,!0),0}else return ERRNO_BADF},path_readlink(fd,path_ptr,path_len,buf_ptr,buf_len,nread_ptr){const buffer=new DataView(self.inst.exports.memory.buffer),buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const path=new TextDecoder("utf-8").decode(buffer8.slice(path_ptr,path_ptr+path_len));debug.log(path);const{ret,data}=self.fds[fd].path_readlink(path);if(data!=null){const data_buf=new TextEncoder().encode(data);if(data_buf.length>buf_len)return buffer.setUint32(nread_ptr,0,!0),ERRNO_BADF;buffer8.set(data_buf,buf_ptr),buffer.setUint32(nread_ptr,data_buf.length,!0)}return ret}else return ERRNO_BADF},path_remove_directory(fd,path_ptr,path_len){const buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const path=new TextDecoder("utf-8").decode(buffer8.slice(path_ptr,path_ptr+path_len));return self.fds[fd].path_remove_directory(path)}else return ERRNO_BADF},path_rename(fd,old_path_ptr,old_path_len,new_fd,new_path_ptr,new_path_len){throw"FIXME what is the best abstraction for this?"},path_symlink(old_path_ptr,old_path_len,fd,new_path_ptr,new_path_len){const buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const old_path=new TextDecoder("utf-8").decode(buffer8.slice(old_path_ptr,old_path_ptr+old_path_len)),new_path=new TextDecoder("utf-8").decode(buffer8.slice(new_path_ptr,new_path_ptr+new_path_len));return self.fds[fd].path_symlink(old_path,new_path)}else return ERRNO_BADF},path_unlink_file(fd,path_ptr,path_len){const buffer8=new Uint8Array(self.inst.exports.memory.buffer);if(self.fds[fd]!=null){const path=new TextDecoder("utf-8").decode(buffer8.slice(path_ptr,path_ptr+path_len));return self.fds[fd].path_unlink_file(path)}else return ERRNO_BADF},poll_oneoff(in_,out,nsubscriptions){throw"async io not supported"},proc_exit(exit_code){throw new WASIProcExit(exit_code)},proc_raise(sig){throw"raised signal "+sig},sched_yield(){},random_get(buf,buf_len){const buffer8=new Uint8Array(self.inst.exports.memory.buffer);for(let i=0;i<buf_len;i++)buffer8[buf+i]=Math.random()*256|0},sock_recv(fd,ri_data,ri_flags){throw"sockets not supported"},sock_send(fd,si_data,si_flags){throw"sockets not supported"},sock_shutdown(fd,how){throw"sockets not supported"},sock_accept(fd,flags){throw"sockets not supported"}}}};class Fd{fd_advise(offset,len,advice){return ERRNO_SUCCESS}fd_allocate(offset,len){return ERRNO_NOTSUP}fd_close(){return 0}fd_datasync(){return ERRNO_NOTSUP}fd_fdstat_get(){return{ret:ERRNO_NOTSUP,fdstat:null}}fd_fdstat_set_flags(flags){return ERRNO_NOTSUP}fd_fdstat_set_rights(fs_rights_base,fs_rights_inheriting){return ERRNO_NOTSUP}fd_filestat_get(){return{ret:ERRNO_NOTSUP,filestat:null}}fd_filestat_set_size(size){return ERRNO_NOTSUP}fd_filestat_set_times(atim,mtim,fst_flags){return ERRNO_NOTSUP}fd_pread(view8,iovs,offset){return{ret:ERRNO_NOTSUP,nread:0}}fd_prestat_get(){return{ret:ERRNO_NOTSUP,prestat:null}}fd_prestat_dir_name(){return{ret:ERRNO_NOTSUP,prestat_dir_name:null}}fd_pwrite(view8,iovs,offset){return{ret:ERRNO_NOTSUP,nwritten:0}}fd_read(view8,iovs){return{ret:ERRNO_NOTSUP,nread:0}}fd_readdir_single(cookie){return{ret:ERRNO_NOTSUP,dirent:null}}fd_seek(offset,whence){return{ret:ERRNO_NOTSUP,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:ERRNO_NOTSUP,offset:0n}}fd_write(view8,iovs){return{ret:ERRNO_NOTSUP,nwritten:0}}path_create_directory(path){return ERRNO_NOTSUP}path_filestat_get(flags,path){return{ret:ERRNO_NOTSUP,filestat:null}}path_filestat_set_times(flags,path,atim,mtim,fst_flags){return ERRNO_NOTSUP}path_link(old_fd,old_flags,old_path,new_path){return ERRNO_NOTSUP}path_open(dirflags,path,oflags,fs_rights_base,fs_rights_inheriting,fd_flags){return{ret:ERRNO_NOTSUP,fd_obj:null}}path_readlink(path){return{ret:ERRNO_NOTSUP,data:null}}path_remove_directory(path){return ERRNO_NOTSUP}path_rename(old_path,new_fd,new_path){return ERRNO_NOTSUP}path_symlink(old_path,new_path){return ERRNO_NOTSUP}path_unlink_file(path){return ERRNO_NOTSUP}}class OpenFile extends Fd{fd_allocate(offset,len){if(!(this.file.size>offset+len)){const new_data=new Uint8Array(Number(offset+len));new_data.set(this.file.data,0),this.file.data=new_data}return ERRNO_SUCCESS}fd_fdstat_get(){return{ret:0,fdstat:new Fdstat(FILETYPE_REGULAR_FILE,0)}}fd_filestat_set_size(size){if(this.file.size>size)this.file.data=new Uint8Array(this.file.data.buffer.slice(0,Number(size)));else{const new_data=new Uint8Array(Number(size));new_data.set(this.file.data,0),this.file.data=new_data}return ERRNO_SUCCESS}fd_read(view8,iovs){let nread=0;for(const iovec of iovs)if(this.file_pos<this.file.data.byteLength){const slice=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(iovec.buf_len)));view8.set(slice,iovec.buf),this.file_pos+=BigInt(slice.length),nread+=slice.length}else break;return{ret:0,nread}}fd_pread(view8,iovs,offset){let nread=0;for(const iovec of iovs)if(offset<this.file.data.byteLength){const slice=this.file.data.slice(Number(offset),Number(offset+BigInt(iovec.buf_len)));view8.set(slice,iovec.buf),offset+=BigInt(slice.length),nread+=slice.length}else break;return{ret:0,nread}}fd_seek(offset,whence){let calculated_offset;switch(whence){case WHENCE_SET:calculated_offset=offset;break;case WHENCE_CUR:calculated_offset=this.file_pos+offset;break;case WHENCE_END:calculated_offset=BigInt(this.file.data.byteLength)+offset;break;default:return{ret:ERRNO_INVAL,offset:0n}}return calculated_offset<0?{ret:ERRNO_INVAL,offset:0n}:(this.file_pos=calculated_offset,{ret:0,offset:this.file_pos})}fd_tell(){return{ret:0,offset:this.file_pos}}fd_write(view8,iovs){let nwritten=0;if(this.file.readonly)return{ret:ERRNO_BADF,nwritten};for(const iovec of iovs){const buffer=view8.slice(iovec.buf,iovec.buf+iovec.buf_len);if(this.file_pos+BigInt(buffer.byteLength)>this.file.size){const old=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(buffer.byteLength))),this.file.data.set(old)}this.file.data.set(buffer.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(buffer.byteLength),nwritten+=iovec.buf_len}return{ret:0,nwritten}}fd_pwrite(view8,iovs,offset){let nwritten=0;if(this.file.readonly)return{ret:ERRNO_BADF,nwritten};for(const iovec of iovs){const buffer=view8.slice(iovec.buf,iovec.buf+iovec.buf_len);if(offset+BigInt(buffer.byteLength)>this.file.size){const old=this.file.data;this.file.data=new Uint8Array(Number(offset+BigInt(buffer.byteLength))),this.file.data.set(old)}this.file.data.set(buffer.slice(0,Number(this.file.size-offset)),Number(offset)),offset+=BigInt(buffer.byteLength),nwritten+=iovec.buf_len}return{ret:0,nwritten}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(file){super(),this.file_pos=0n,this.file=file}}class OpenSyncOPFSFile extends Fd{fd_allocate(offset,len){return BigInt(this.file.handle.getSize())>offset+len||this.file.handle.truncate(Number(offset+len)),ERRNO_SUCCESS}fd_fdstat_get(){return{ret:0,fdstat:new Fdstat(FILETYPE_REGULAR_FILE,0)}}fd_filestat_get(){return{ret:0,filestat:new Filestat(FILETYPE_REGULAR_FILE,BigInt(this.file.handle.getSize()))}}fd_filestat_set_size(size){return this.file.handle.truncate(Number(size)),ERRNO_SUCCESS}fd_read(view8,iovs){let nread=0;for(const iovec of iovs)if(this.position<this.file.handle.getSize()){const buf=new Uint8Array(view8.buffer,iovec.buf,iovec.buf_len),n=this.file.handle.read(buf,{at:Number(this.position)});this.position+=BigInt(n),nread+=n}else break;return{ret:0,nread}}fd_seek(offset,whence){let calculated_offset;switch(whence){case WHENCE_SET:calculated_offset=BigInt(offset);break;case WHENCE_CUR:calculated_offset=this.position+BigInt(offset);break;case WHENCE_END:calculated_offset=BigInt(this.file.handle.getSize())+BigInt(offset);break;default:return{ret:ERRNO_INVAL,offset:0n}}return calculated_offset<0?{ret:ERRNO_INVAL,offset:0n}:(this.position=calculated_offset,{ret:ERRNO_SUCCESS,offset:this.position})}fd_write(view8,iovs){let nwritten=0;if(this.file.readonly)return{ret:ERRNO_BADF,nwritten};for(const iovec of iovs){const buf=new Uint8Array(view8.buffer,iovec.buf,iovec.buf_len),n=this.file.handle.write(buf,{at:Number(this.position)});this.position+=BigInt(n),nwritten+=n}return{ret:ERRNO_SUCCESS,nwritten}}fd_datasync(){return this.file.handle.flush(),ERRNO_SUCCESS}fd_sync(){return this.fd_datasync()}fd_close(){return ERRNO_SUCCESS}constructor(file){super(),this.position=0n,this.file=file}}class OpenDirectory extends Fd{fd_seek(offset,whence){return{ret:ERRNO_ISDIR,offset:0n}}fd_fdstat_get(){return{ret:0,fdstat:new Fdstat(FILETYPE_DIRECTORY,0)}}fd_readdir_single(cookie){if(debug.enabled&&(debug.log("readdir_single",cookie),debug.log(cookie,Object.keys(this.dir.contents))),debug.log(cookie,Object.keys(this.dir.contents).slice(Number(cookie))),cookie>=BigInt(Object.keys(this.dir.contents).length))return{ret:0,dirent:null};const name=Object.keys(this.dir.contents)[Number(cookie)],entry=this.dir.contents[name];return{ret:0,dirent:new Dirent(cookie+1n,name,entry.stat().filetype)}}path_filestat_get(flags,path){const entry=this.dir.get_entry_for_path(path);return entry==null?{ret:ERRNO_NOENT,filestat:null}:{ret:0,filestat:entry.stat()}}path_open(dirflags,path,oflags,fs_rights_base,fs_rights_inheriting,fd_flags){let entry=this.dir.get_entry_for_path(path);if(entry==null)if((oflags&OFLAGS_CREAT)==OFLAGS_CREAT)entry=this.dir.create_entry_for_path(path,(oflags&OFLAGS_DIRECTORY)==OFLAGS_DIRECTORY);else return{ret:ERRNO_NOENT,fd_obj:null};else if((oflags&OFLAGS_EXCL)==OFLAGS_EXCL)return{ret:ERRNO_EXIST,fd_obj:null};if((oflags&OFLAGS_DIRECTORY)==OFLAGS_DIRECTORY&&entry.stat().filetype!==FILETYPE_DIRECTORY)return{ret:ERRNO_NOTDIR,fd_obj:null};if(entry.readonly&&(fs_rights_base&BigInt(RIGHTS_FD_WRITE))==BigInt(RIGHTS_FD_WRITE))return{ret:ERRNO_PERM,fd_obj:null};if(!(entry instanceof Directory)&&(oflags&OFLAGS_TRUNC)==OFLAGS_TRUNC){const ret=entry.truncate();if(ret!=ERRNO_SUCCESS)return{ret,fd_obj:null}}return{ret:ERRNO_SUCCESS,fd_obj:entry.open(fd_flags)}}path_create_directory(path){return this.path_open(0,path,OFLAGS_CREAT|OFLAGS_DIRECTORY,0n,0n,0).ret}path_unlink_file(path){path=this.clean_path(path);const parentDirEntry=this.dir.get_parent_dir_for_path(path),pathComponents=path.split("/"),fileName=pathComponents[pathComponents.length-1],entry=this.dir.get_entry_for_path(path);return entry===null?ERRNO_NOENT:entry.stat().filetype===FILETYPE_DIRECTORY?ERRNO_ISDIR:(delete parentDirEntry.contents[fileName],ERRNO_SUCCESS)}path_remove_directory(path){path=this.clean_path(path);const parentDirEntry=this.dir.get_parent_dir_for_path(path),pathComponents=path.split("/"),fileName=pathComponents[pathComponents.length-1],entry=this.dir.get_entry_for_path(path);return entry===null?ERRNO_NOENT:!(entry instanceof Directory)||entry.stat().filetype!==FILETYPE_DIRECTORY?ERRNO_NOTDIR:Object.keys(entry.contents).length!==0?ERRNO_NOTEMPTY:parentDirEntry.contents[fileName]===void 0?ERRNO_NOENT:(delete parentDirEntry.contents[fileName],ERRNO_SUCCESS)}clean_path(path){for(;path.length>0&&path[path.length-1]==="/";)path=path.slice(0,path.length-1);return path}constructor(dir){super(),this.dir=dir}}class PreopenDirectory extends OpenDirectory{fd_prestat_get(){return{ret:0,prestat:Prestat.dir(this.prestat_name.length)}}fd_prestat_dir_name(){return{ret:0,prestat_dir_name:this.prestat_name}}constructor(name,contents){super(new Directory(contents)),this.prestat_name=new TextEncoder().encode(name)}}class File{open(fd_flags){const file=new OpenFile(this);return fd_flags&FDFLAGS_APPEND&&file.fd_seek(0n,WHENCE_END),file}get size(){return BigInt(this.data.byteLength)}stat(){return new Filestat(FILETYPE_REGULAR_FILE,this.size)}truncate(){return this.readonly?ERRNO_PERM:(this.data=new Uint8Array([]),ERRNO_SUCCESS)}constructor(data,options){this.data=new Uint8Array(data),this.readonly=!!options?.readonly}}class SyncOPFSFile{open(fd_flags){const file=new OpenSyncOPFSFile(this);return fd_flags&wasi.FDFLAGS_APPEND&&file.fd_seek(0n,wasi.WHENCE_END),file}get size(){return BigInt(this.handle.getSize())}stat(){return new wasi.Filestat(wasi.FILETYPE_REGULAR_FILE,this.size)}truncate(){return this.readonly?wasi.ERRNO_PERM:(this.handle.truncate(0),wasi.ERRNO_SUCCESS)}constructor(handle,options){this.handle=handle,this.readonly=!!options?.readonly}}class Directory{open(fd_flags){return new OpenDirectory(this)}stat(){return new Filestat(FILETYPE_DIRECTORY,0n)}get_entry_for_path(path){let entry=this;for(const component of path.split("/")){if(component=="")break;if(component!="."){if(!(entry instanceof Directory))return null;if(entry.contents[component]!=null)entry=entry.contents[component];else return debug.log(component),null}}return entry}get_parent_dir_for_path(path){if(path==="")return null;let entry=this,parentEntry=entry;for(const component of path.split("/")){if(component==="")break;if(component!=="."){if(!(entry instanceof Directory))return debug.log(entry),null;if(entry.contents[component]===void 0)return debug.log(component),null;parentEntry=entry,entry=entry.contents[component]}}return parentEntry}create_entry_for_path(path,is_dir){let entry=this;const components=path.split("/").filter(component=>component!="/");for(let i=0;i<components.length;i++){const component=components[i];if(!(entry instanceof Directory))break;entry.contents[component]!=null||(debug.log("create",component),i==components.length-1&&!is_dir?entry.contents[component]=new File(new ArrayBuffer(0)):entry.contents[component]=new Directory({})),entry=entry.contents[component]}return entry}constructor(contents){this.readonly=!1,this.contents=contents}}class ConsoleStdout extends Fd{fd_filestat_get(){return{ret:0,filestat:new Filestat(FILETYPE_CHARACTER_DEVICE,BigInt(0))}}fd_fdstat_get(){const fdstat=new Fdstat(FILETYPE_CHARACTER_DEVICE,0);return fdstat.fs_rights_base=BigInt(RIGHTS_FD_WRITE),{ret:0,fdstat}}fd_write(view8,iovs){let nwritten=0;for(const iovec of iovs){const buffer=view8.slice(iovec.buf,iovec.buf+iovec.buf_len);this.write(buffer),nwritten+=iovec.buf_len}return{ret:0,nwritten}}static lineBuffered(write){const dec=new TextDecoder("utf-8",{fatal:!1});let line_buf="";return new ConsoleStdout(buffer=>{line_buf+=dec.decode(buffer,{stream:!0});const lines=line_buf.split(`
`);for(const[i,line]of lines.entries())i<lines.length-1?write(line):line_buf=line})}constructor(write){super(),this.write=write}}}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==void 0)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}(()=>{var webpackQueues=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",webpackExports=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",webpackError=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",resolveQueue=queue=>{queue&&queue.d<1&&(queue.d=1,queue.forEach(fn=>fn.r--),queue.forEach(fn=>fn.r--?fn.r++:fn()))},wrapDeps=deps=>deps.map(dep=>{if(dep!==null&&typeof dep=="object"){if(dep[webpackQueues])return dep;if(dep.then){var queue=[];queue.d=0,dep.then(r=>{obj[webpackExports]=r,resolveQueue(queue)},e=>{obj[webpackError]=e,resolveQueue(queue)});var obj={};return obj[webpackQueues]=fn=>fn(queue),obj}}var ret={};return ret[webpackQueues]=x=>{},ret[webpackExports]=dep,ret});__webpack_require__.a=(module,body,hasAwait)=>{var queue;hasAwait&&((queue=[]).d=-1);var depQueues=new Set,exports=module.exports,currentDeps,outerResolve,reject,promise=new Promise((resolve,rej)=>{reject=rej,outerResolve=resolve});promise[webpackExports]=exports,promise[webpackQueues]=fn=>(queue&&fn(queue),depQueues.forEach(fn),promise.catch(x=>{})),module.exports=promise,body(deps=>{currentDeps=wrapDeps(deps);var fn,getResult=()=>currentDeps.map(d=>{if(d[webpackError])throw d[webpackError];return d[webpackExports]}),promise2=new Promise(resolve=>{fn=()=>resolve(getResult),fn.r=0;var fnQueue=q=>q!==queue&&!depQueues.has(q)&&(depQueues.add(q),q&&!q.d&&(fn.r++,q.push(fn)));currentDeps.map(dep=>dep[webpackQueues](fnQueue))});return fn.r?promise2:getResult()},err=>(err?reject(promise[webpackError]=err):outerResolve(exports),resolveQueue(queue))),queue&&queue.d<0&&(queue.d=0)}})(),__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.r=exports=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(682);h$wasm=__webpack_exports__})();
